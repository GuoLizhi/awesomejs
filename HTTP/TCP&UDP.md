TCP和UDP是两个有代表性的传输层协议。

### 1. UDP

UDP：用户数据协议，是一种无连接的协议。当报文发送之后，是无法得知其是否安全完整到达的。（只管发，不管对方接收到了没有）

UDP的主要特点：

1. 首先 UDP 是不需要和 TCP一样在发送数据前进行三次握手建立连接的，想发数据就可以开始发送了。并且也只是数据报文的搬运工，不会对数据报文进行任何拆分和拼接操作。
2. 有单播，多播，广播的功能：不止支持一对一的传输方式，同样支持一对多，多对多，多对一的方式
3. UDP是面向报文的：UDP对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界。因此，应用程序必须选择合适大小的报文
4. 不可靠性：首先不可靠性体现在无连接上，通信都不需要建立连接，想发就发，这样的情况肯定不可靠。 UDP 因为没有拥塞控制，一直会以恒定的速度发送数据。即使网络条件不好，也不会对发送速率进行调整。这样实现的弊端就是在网络条件不好的情况下可能会导致丢包。
5. 头部开销小，传输数据报文很高效

### 2 TCP

TCP：是一种面向连接的、可靠的、基于字节流的传输层通信协议

> TCP是传输层协议，HTTP是应用层协议。从本质上来讲，二者没有可比性。但是HTTP是基于TCP协议的。比如当浏览器需要从获取网页数据时，会发出一次HTTP请求。HTTP会通过TCP建立起一个到服务器的连接通道，当本次请求需要的数据完毕之后，HTTP会立即将TCP连接断开。所以HTTP是一种无状态的短连接。

要了解TCP协议的3次握手和4次挥手的过程，首先需要知道TCP头部的格式

对于这两个过程，主要涉及一下头部字段

1. sequence number 发送请求的顺序号，32位大小
2. acknowledgment number 请求的应答好，32位大小
3. ACK 请求应答的序列号，大小为1位，0或者1。1表示请求已成功收到
4. FIN 请求结束的标记位，大小为1位，0或者1。断开连接时使用
5. SYN 同步序号标记位，大小为1位，0或者1。建立连接时使用

三次握手：

1. 客户端向服务端发送SYN=1的标识，表示请求建立连接。同时会携带，请求的`sequence number`，比如为0001
2. 服务端接收到报文后，会返回一个SYN=1, ACK=1的应答，这里也会返回`acknowledgment number=0001`和`sequence number=2000`（这里的sequence和发送请求的sequence并不一样）
3. 客服端再次向服务端发送带有ACK=1标识的数据包，并且`sequence number=2001`，自此连接被建立起来

四次挥手：

1. 客户端首先发起FIN=1标记，用来请求关闭客户端到服务端的数据传输（`sequence number = 1000`）
2. 服务端接收到之后，会向客户端发送ACK=1标识，表示准备断开连接（`acknowledgment number = 1001`）
3. 服务端再次向客户端发送FIN=1的标识，标识现在可以安全断开连接（`sequence number = 2000`）
4. 客户端接受到请求之后确认，向服务端发送ACK=1包，表示TCP连接结束（`acknowledgment number = 2001`）

TCP协议的特点：

1. 面向连接
2. 仅支持单播传输
3. 面向字节流
4. 可靠传输
5. 提供拥塞控制
6. TCP提供全双工通信

![compare](http://cdn.lznism.com/20201221_01.png)