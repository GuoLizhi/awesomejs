### 1. XSS简介

Cross-Site Scripting（跨站脚本攻击）简称 XSS，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如 Cookie、SessionID 等，进而危害数据安全。

XSS 的本质是：恶意代码未经过滤，与网站正常的代码混在一起，浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。

### 2. XSS分类

1. 存储型 XSS：攻击者将恶意代码提交到目标网站的数据库中。用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在HTML中返回给浏览器。用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。
2. 反射型 XSS：攻击者构造出特殊的 URL，其中包含恶意代码。用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
3. DOM 型 XSS：攻击者构造出特殊的 URL，其中包含恶意代码。用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。

### 3. XSS 攻击的预防

输入过滤，不要相信任何输入。输出检查，比如在富文本输出到前端时，可以使用编码或者转义的方式来防御XSS攻击。

改成纯前端渲染，把代码和数据分隔开

对 HTML 做充分转义

Content Security Policy

1. 禁止加载外域代码，防止复杂的攻击逻辑。
2. 禁止外域提交，网站被攻击后，用户的数据不会泄露到外域。
3. 禁止内联脚本执行（规则较严格，目前发现 GitHub 使用）。
4. 禁止未授权的脚本执行（新特性，Google Map 移动版在使用）。
5. 合理使用上报可以及时发现 XSS，利于尽快修复问题。

HTTP-only Cookie: 禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie。
